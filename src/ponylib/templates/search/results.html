{% extends "base.html" %}
{% load i18n %}


{% block title %}{% endblock %}


{% block head_css %}
    {% if debug_query %}
    {# TMP for debug  #}
    <link rel="stylesheet" href="{{ STATIC_URL }}css/prettify.css?{{ STATIC_KEY }}" />
    {% endif %}
{% endblock %}


{% block head_scripts %}
    {% if debug_query %}
    <script type="text/javascript" src="{{ STATIC_URL }}scripts/min/prettify.js?{{ STATIC_KEY }}"></script>
    <script type="text/javascript">
    jQuery(window).on('load', prettyPrint);
    </script>
    {% endif %}
    <script type="text/javascript" src="{{ STATIC_URL }}scripts/min/jquery.ias.min.js?{{ STATIC_KEY }}"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}scripts/results.js?{{ STATIC_KEY }}"></script>
{% endblock %}


{% block content %}
    {# container for helpers html frangments #}
    <div style="display: none;">

        {# loader #}
        <div class="loader">
            <span class="label">{% trans 'Loading ...' %}</span>
        </div>

    </div>

    {# debug info #}
    {% if debug_query %}
    <div class="debug">
        Type <code>{{ type }}</code>.<br/>
        Request params:
        <pre class="prettyprint linenums languague-python">{{ debug_query_data.request_params }}</pre>

        Query:
        <pre class="prettyprint linenums languague-sql">{{ debug_query_data.qs_query }}</pre>

        Query params:
        <pre class="prettyprint linenums languague-python">{{ debug_query_data.qs_params }}</pre>
    </div>
    {% endif %}

    <div class="row">
    {% include 'parts/search/simple_form.html' %}


    {% if has_search_errors %}

    {# search errors #}
    <div class="row">
    {% for error in search_errors %}
        <div class="alert alert-error span4">{{ error }}</div>
    {% empty %}
        <div class="alert">{% trans 'Unknown error' %}</div>
    {% endfor %}
    </div>


    {% else %}
    {# search results #}
    <h2>{% trans "Search Results" %}</h2>

    <div class="results">
    {% if results %}
        <div class="row results-info">
            <div class="span1 offset11">
                <span class="label">{% trans 'Total' %}: {{ total_count }}</span>
            </div>
        </div>

        <div class="books-list">
        {% for book in results %}
            {% include 'parts/results/book.html' %}
        {% endfor %}
        </div>
    {% else %}
        <div class="row">
            <div class="alert alert-info span4">{% trans 'No results' %}</div>
        </div>
    {% endif %}

    {% include 'parts/results/pagination.html' %}

    </div>

    <script type="text/javascript">
        (function() {
            var navination = new (ns('Ponylib.Results.Navigation'));
            ns('Ponylib.Instances', 'navigation', navination);
        })();
    </script>

    {% endif %}

{% endblock %}